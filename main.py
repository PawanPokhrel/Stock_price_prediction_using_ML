import requests
from bs4 import BeautifulSoup
import csv

Symbol = ["ADBL",
"BOKL",
"CCBL",
"CZBIL",
"CBL",
"EBL",
"GBIME",
"HBL",
"JBNL",
"KBL",
"LBL",
"MBL",
"MEGA",
"NABIL",
"NBB",
"NBL",
"NCCB",
"NIB",
"SBI",
"NICA",
"NMB",
"PRVU",
"PCBL",
"SANIMA",
"SBL",
"SCB",
"SRBL",
"BFC",
"CMB",
"CFCL",
"CEFL",
"CFL",
"GFCL",
"GMFIL",
"GUFL",
"HATH",
"HFL",
"ICFC",
"JFL",
"LFC",
"MFIL",
"MPFL",
"NFS",
"NSM",
"PFL",
"PROFL",
"RLFL",
"SFC",
"SFCL",
"SIFC",
"SFFIL",
"SYFL",
"UFL",
"CGH",
"OHL",
"SHL",
"TRH",
"YHL",
"AVU",
"BSL",
"BNL",
"BNT",
"BSM",
"FHL",
"GRU",
"HBT",
"HDL",
"JSM",
"NBBU",
"NKU",
"NLO",
"NVG",
"RJM",
"SHIVM",
"SBPP",
"SRS",
"UNL",
"NTC",
"NFD",
"NRIC",
"AKJCL",
"API",
"AKPL",
"AHPC",
"BARUN",
"BPCL",
"CHL",
"CHCL",
"DHPL",
"GHL",
"GLH",
"HDHPC",
"HURJA",
"HPPL",
"JOSHI",
"KPCL",
"KKHC",
"LEC",
"MKJC",
"MEN",
"MHNL",
"NHPC",
"NHDL",
"NGPL",
"NYADI",
"PMHPL",
"PPCL",
"RADHI",
"RRHP",
"RHPL",
"RHPC",
"RURU",
"SAHAS",
"SPC",
"SHPC",
"SJCL",
"SSHL",
"SHEL",
"SPDL",
"TPC",
"UNHPL",
"UMRH",
"UMHL",
"UPCL",
"UPPER",
"BBC",
"NTL",
"NWC",
"STC",
"AIL",
"EIC",
"GIC",
"HGI",
"IGI",
"LGIL",
"NIL",
"NICL",
"NLG",
"PRIN",
"PIC",
"PICL",
"RBCL",
"SIC",
"SGI",
"SICL",
"SIL",
"UIC",
"ACLBSL",
"AKBSL",
"AMFI",
"ALBSL",
"CBBL",
"CLBSL",
"DDBL",
"FMDBL",
"FOWAD",
"GMFBS",
"GGBSL",
"GILB",
"GBLBS",
"GLBSL",
"ILBS",
"JSLBB",
"JBLB",
"KMCDB",
"KLBSL",
"LLBS",
"MLBSL",
"MSMBS",
"MSLB",
"MKLB",
"MLBS",
"MERO",
"MMFDB",
"MLBBL",
"NADEP",
"NMFBS",
"NSLB",
"NAGRO",
"NSEWA",
"NLBBL",
"NICLBSL",
"NUBL",
"NMBMF",
"RMDC",
"RSDC",
"SABSL",
"SDLBSL",
"SAMAJ",
"SMATA",
"SLBSL",
"SKBBL",
"SPARS",
"SMFDB",
"SMB",
"SLBS",
"SWBBL",
"SMFBS",
"SDESI",
"SLBBL",
"USLB",
"VLBS",
"WOMI",
"ALICL",
"GLICL",
"JLI",
"LICN",
"NLICL",
"NLIC",
"PLI",
"PLIC",
"RLI",
"SLI",
"SLICL",
"ULI",
"CHDC",
"CIT",
"HIDCL",
"NIFRA",
"NRN"
]

file = open('stocklist.csv', 'w',newline='')        #newline='' avoids creating blank newline in each iteration

writer = csv.writer(file)
writer.writerow(['Symbol','PE'])
for y in Symbol:

    url = "https://merolagani.com/CompanyDetail.aspx?symbol=" + y #y is looping variable for string array symbol

    r = requests.get(url)
    htmlText = r.text

    soup = BeautifulSoup(htmlText, 'html.parser')

    table = soup.find('table', class_="table table-striped table-hover table-zeromargin", id="accordion")

    c = 0


    # writer.writerow(['Symbol','PE'])

    for x in table.find_all('tbody'):
        for row in x.find_all('tr'):
            # Find all data for each column
            columns = row.find('td')
            # z = len(columns)
            # print(z)
            if columns is not None:             #this if condition avoids error for not returning text.
                PE_Ratio = columns.text.strip()    #text.srip().split(), if we use split() then it gives data in ['16.20'] for instead of 16.20
            c = c+1     #counter to print PE_Ratio only, when c = 11, if condition executes and then PE_Ratio is printed
            if(c==11):
                print(PE_Ratio)
                writer.writerow([y, PE_Ratio])

